<!DOCTYPE html>
<html>
<head>
    <title>è–ªèµ„è®¡æ—¶å™¨</title>
    <style>
        /* èƒŒæ™¯å®¹å™¨æ ·å¼ */
        #background-container {
    z-index: -1; /* ç¡®ä¿èƒŒæ™¯åœ¨åº•å±‚ */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        /* ä¸»å®¹å™¨å¸ƒå±€ */
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        /* æŒ‰é’®æ ·å¼ */
        #start-btn {
            padding: 10px 20px;
            margin-left: 10px;
            cursor: pointer;
        }
        /* æ•°å­—æ˜¾ç¤ºæ ·å¼ */
        #time-display, #money-display {
            font-size: 3em;
            margin: 20px 0;
            text-align: center;
        }
        /* é‡‘å¸åŠ¨ç”» */
        @keyframes coinBurst {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            100% { transform: scale(4) rotate(360deg); opacity: 0; }
        }
        .coin-effect {
            animation: coinBurst 1s ease-out;
            position: absolute;
            width: 50px;
            animation: coinBurst 1s ease-out forwards;
        }
    </style>
    
</head>
<body>
    <!-- æ·»åŠ èƒŒæ™¯å®¹å™¨ -->
    <div id="background-container"></div>
    
    <!-- æ·»åŠ ä¸Šä¼ æ§ä»¶ -->
    <input type="file" id="bg-upload" accept="image/*" style="position: absolute; top: 10px; right: 10px;">
    
    <!-- ä¿®æ”¹åçš„å®¹å™¨ç»“æ„ -->
    <!-- åˆ é™¤é‡å¤çš„å®¹å™¨å…ƒç´ ï¼Œä¿ç•™å”¯ä¸€æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="container">
        <div class="input-group">
            <span style="margin-right:10px">æœˆå·¥èµ„</span>
            <input type="number" id="salary" placeholder="è¾“å…¥æœˆè–ªï¼ˆå…ƒï¼‰">
            <div style="display: flex; gap: 10px; margin: 10px 0;">
                <div>
                    <span>å·¥ä½œæ—¥</span>
                    <input type="number" id="workdays" min="1" max="31" value="22" style="width: 60px">
                </div>
                <div>
                    <span>æ¯æ—¥æ—¶é•¿</span>
                    <input type="number" id="dailyHours" min="1" max="24" value="8" style="width: 60px">
                </div>
            </div>
            <select id="currency">
                <option value="CNY">äººæ°‘å¸</option>
                <option value="USD">ç¾å…ƒ</option>
            </select>
            <button id="start-btn" onclick="startTimer()">å¼€å§‹èµšé’±</button>
        </div>
        
        <!-- æ—¶é—´æ˜¾ç¤ºåŒºåŸŸ -->
        <div id="time-display">è®¡æ—¶ï¼š00:00:00</div>
        
        <!-- é‡‘é¢æ˜¾ç¤ºåŒºåŸŸ -->
        <div id="money-display">0.00 <small id="currency-unit">å…ƒ</small></div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€ç®¡ç†
        let isRunning = false;
        let timer = null;
        let startTime = 0;
        let totalEarned = 0;
        let lastHundred = 0;

        window.addEventListener('DOMContentLoaded', init);
        function init() {
            document.getElementById('currency').addEventListener('change', updateCurrencyUnit);
            
            const savedBg = localStorage.getItem('background');
            if(savedBg) {
                document.getElementById('background-container').style.backgroundImage = `url(${savedBg})`;
            }

            document.getElementById('bg-upload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    console.log('ä¿å­˜èƒŒæ™¯å›¾ç‰‡æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨');
                    localStorage.setItem('background', e.target.result);
                    console.log('å½“å‰å­˜å‚¨å†…å®¹:', localStorage.getItem('background')?.substring(0,50) || 'æ— å­˜å‚¨å†…å®¹');
                    console.log('èƒŒæ™¯å®¹å™¨æ ·å¼:', document.getElementById('background-container').style.backgroundImage);
                    document.getElementById('background-container').style.backgroundImage = `url(${e.target.result})`;
                };
                
                // æ·»åŠ é”™è¯¯å¤„ç†
                reader.onerror = function(e) {
                    console.error('æ–‡ä»¶è¯»å–å¤±è´¥:', e.target.error);
                };

                reader.readAsDataURL(file);
            });
        }

        function startTimer() {
            if (!isRunning) {
                isRunning = true;
                startTime = Date.now();
                totalEarned = 0;
                lastHundred = 0;
                timer = setInterval(updateDisplay, 1000);
                document.getElementById('start-btn').disabled = true;
            }
        }

        function updateDisplay() {
            const currentTime = Date.now();
            const elapsed = currentTime - startTime;
            
            const hours = Math.floor(elapsed / 3600000);
            const minutes = Math.floor((elapsed % 3600000) / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            document.getElementById('time-display').textContent = 
                `è®¡æ—¶ï¼š${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            const salary = document.getElementById('salary').value || 0;
            const workdays = Math.max(1, Math.min(31, document.getElementById('workdays').value || 22));
            const dailyHours = Math.max(1, Math.min(24, document.getElementById('dailyHours').value || 8));
            const hourly = salary / workdays / dailyHours;
            const perSecond = hourly / 3600;
            totalEarned += perSecond;

            // æ¯æ»¡100å…ƒè§¦å‘é‡‘å¸åŠ¨ç”»
            if (Math.floor(totalEarned / 100) > Math.floor(lastHundred / 100)) {
                createCoinEffect();
                lastHundred = totalEarned;
            }

            const converted = convertCurrency(totalEarned);
            document.getElementById('money-display').innerHTML = 
                `${converted.toFixed(2)} <small id="currency-unit">${document.getElementById('currency').value === 'CNY' ? 'å…ƒ' : 'ç¾å…ƒ'}</small>`;
        }

        function createCoinEffect() {
    const coin = document.createElement('div');
    coin.innerHTML = 'ğŸª™';
    coin.style.cssText = `
        position: fixed;
        top: ${window.innerHeight/2}px;
        left: ${window.innerWidth/2}px;
        font-size: 40px;
        pointer-events: none;
    `;
    coin.classList.add('coin-effect');
    document.body.appendChild(coin);
    
    coin.addEventListener('animationend', () => {
        coin.remove();
    });
}

function convertCurrency(amount) {
            const rate = document.getElementById('currency').value === 'CNY' ? 1 : 6.7;
            return amount * rate;
        }
    </script>
</body>
</html>
